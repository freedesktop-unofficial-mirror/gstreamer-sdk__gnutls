@node p11tool Invocation
@subsection Invoking p11tool
@pindex p11tool
@cindex GnuTLS PKCS #11 tool
@ignore
#  -*- buffer-read-only: t -*- vi: set ro:
# 
# DO NOT EDIT THIS FILE   (invoke-p11tool.texi)
# 
# It has been AutoGen-ed  February 19, 2012 at 11:22:33 PM by AutoGen 5.15pre10
# From the definitions    ../src/p11tool-args.def
# and the template file   agtexi-cmd.tpl
@end ignore


Program that allows handling data from PKCS #11 smart cards
and security modules. 

To use PKCS #11 tokens with gnutls the configuration file 
/etc/gnutls/pkcs11.conf has to exist and contain a number of lines of the form 'load=/usr/lib/opensc-pkcs11.so'.


This section was generated by @strong{AutoGen},
using the @code{agtexi-cmd} template and the option descriptions for the @code{p11tool} program.
This software is released under the GNU General Public License, version 3 or later.


@subsubheading p11tool usage (-h)
@cindex p11tool usage

This is the automatically generated usage text for p11tool:

@exampleindent 0
@example
p11tool - GnuTLS PKCS #11 tool - Ver. @@VERSION@@
USAGE:  p11tool [ -<flag> [<val>] | --<name>[@{=| @}<val>] ]... [url]

   -d, --debug=num            Enable debugging.
                                - It must be in the range:
                                  0 to 9999
       --outfile=str          Output file
       --list-tokens          List all available tokens
       --export               Export the object specified by the URL
       --list-mechanisms      List all available mechanisms in a token
       --list-all             List all available objects in a token
       --list-all-certs       List all available certificates in a token
       --list-certs           List all certificates that have an associated private key
       --list-all-privkeys    List all available private keys in a token
       --list-all-trusted     List all available certificates marked as trusted
       --initialize           Initializes a PKCS #11 token
       --write                Writes the loaded objects to a PKCS #11 token
       --delete               Deletes the objects matching the PKCS #11 URL
       --generate-rsa         Generates an RSA private-public key pair on the specified token
       --generate-dsa         Generates an RSA private-public key pair on the specified token
       --generate-ecc         Generates an RSA private-public key pair on the specified token
       --label=str            Sets a label for the write operation
       --trusted              Marks the object to be written as trusted
                                - disabled as --no-trusted
       --private              Marks the object to be written as private
                                - disabled as --no-private
                                - enabled by default
       --login                Force login to token
                                - disabled as --no-login
       --detailed-url         Print detailed URLs
                                - disabled as --no-detailed-url
       --secret-key=str       Provide a hex encoded secret key
       --load-privkey=file    Private key file to use
                                - file must pre-exist
       --load-pubkey=file     Public key file to use
                                - file must pre-exist
       --load-certificate=file Certificate file to use
                                - file must pre-exist
   -8, --pkcs8                Use PKCS #8 format for private keys
       --bits=num             Specify the number of bits for key generate
       --sec-param=str        Specify the security level [low|legacy|normal|high|ultra].
       --inder                Use DER/RAW format for input certificates and private keys
                                - disabled as --no-inder
       --inraw                This is an alias for 'inder'
       --provider=file        Specify the PKCS #11 provider library
                                - file must pre-exist
   -v, --version[=arg]        Output version information and exit
   -h, --help                 Display extended usage information and exit
   -!, --more-help            Extended usage information passed thru pager

Options are specified by doubled hyphens and their name or by a single
hyphen and the flag character.
Operands and options may be intermixed.  They will be reordered.



Program that allows handling data from PKCS #11 smart cards and security
modules.

To use PKCS #11 tokens with gnutls the configuration file
/etc/gnutls/pkcs11.conf has to exist and contain a number of lines of
the form 'load=/usr/lib/opensc-pkcs11.so'.

please send bug reports to:  bug-gnutls@@gnu.org
@end example
@exampleindent 4

@subsubheading bits option
@cindex p11tool-bits

This is the ``specify the number of bits for key generate'' option.


@subsubheading debug option (-d)
@cindex p11tool-debug

This is the ``enable debugging.'' option.
Specifies the debug level.

@subsubheading delete option
@cindex p11tool-delete

This is the ``deletes the objects matching the pkcs #11 url'' option.


@subsubheading detailed-url option
@cindex p11tool-detailed-url

This is the ``print detailed urls'' option.


@subsubheading export option
@cindex p11tool-export

This is the ``export the object specified by the url'' option.


@subsubheading generate-dsa option
@cindex p11tool-generate-dsa

This is the ``generates an rsa private-public key pair on the specified token'' option.


@subsubheading generate-ecc option
@cindex p11tool-generate-ecc

This is the ``generates an rsa private-public key pair on the specified token'' option.


@subsubheading generate-rsa option
@cindex p11tool-generate-rsa

This is the ``generates an rsa private-public key pair on the specified token'' option.


@subsubheading inder option
@cindex p11tool-inder

This is the ``use der/raw format for input certificates and private keys'' option.


@subsubheading initialize option
@cindex p11tool-initialize

This is the ``initializes a pkcs #11 token'' option.


@subsubheading inraw option
@cindex p11tool-inraw

This is the ``'' option.
This option has no @samp{doc} documentation.

@subsubheading label option
@cindex p11tool-label

This is the ``sets a label for the write operation'' option.


@subsubheading list-all option
@cindex p11tool-list-all

This is the ``list all available objects in a token'' option.


@subsubheading list-all-certs option
@cindex p11tool-list-all-certs

This is the ``list all available certificates in a token'' option.


@subsubheading list-all-privkeys option
@cindex p11tool-list-all-privkeys

This is the ``list all available private keys in a token'' option.


@subsubheading list-all-trusted option
@cindex p11tool-list-all-trusted

This is the ``list all available certificates marked as trusted'' option.


@subsubheading list-certs option
@cindex p11tool-list-certs

This is the ``list all certificates that have an associated private key'' option.


@subsubheading list-mechanisms option
@cindex p11tool-list-mechanisms

This is the ``list all available mechanisms in a token'' option.


@subsubheading list-tokens option
@cindex p11tool-list-tokens

This is the ``list all available tokens'' option.


@subsubheading load-certificate option
@cindex p11tool-load-certificate

This is the ``certificate file to use'' option.


@subsubheading load-privkey option
@cindex p11tool-load-privkey

This is the ``private key file to use'' option.


@subsubheading load-pubkey option
@cindex p11tool-load-pubkey

This is the ``public key file to use'' option.


@subsubheading login option
@cindex p11tool-login

This is the ``force login to token'' option.


@subsubheading outfile option
@cindex p11tool-outfile

This is the ``output file'' option.


@subsubheading pkcs8 option (-8)
@cindex p11tool-pkcs8

This is the ``use pkcs #8 format for private keys'' option.


@subsubheading private option
@cindex p11tool-private

This is the ``marks the object to be written as private'' option.

This option has some usage constraints.  It:
@itemize @bullet
@item
is enabled by default.
@end itemize

The written object will require a PIN to be used.

@subsubheading provider option
@cindex p11tool-provider

This is the ``specify the pkcs #11 provider library'' option.
This will override the default options in /etc/gnutls/pkcs11.conf

@subsubheading sec-param option
@cindex p11tool-sec-param

This is the ``specify the security level [low|legacy|normal|high|ultra].'' option.
This is alternative to the bits option.

@subsubheading secret-key option
@cindex p11tool-secret-key

This is the ``provide a hex encoded secret key'' option.


@subsubheading trusted option
@cindex p11tool-trusted

This is the ``marks the object to be written as trusted'' option.


@subsubheading write option
@cindex p11tool-write

This is the ``writes the loaded objects to a pkcs #11 token'' option.
It can be used to write private keys, certificates or secret keys to a token.

@subsubheading p11tool exit status

One of the following exit values will be returned:
@table @samp
@item 0
Successful program execution.
@item 1
The operation failed or the command syntax was not valid.
@end table


@subsubheading p11tool See Also

    certtool (1)


@subsubheading p11tool Examples

To view all tokens in your system use:
@example
$ p11tool --list-tokens
@end example

To view all objects in a token use:
@example
$ p11tool --login --list-all "pkcs11:TOKEN-URL"
@end example

To store a private key and a certificate in a token run:
@example
$ p11tool --login --write "pkcs11:URL" --load-privkey key.pem --label "Mykey"
$ p11tool --login --write "pkcs11:URL" --load-certificate cert.pem --label "MyCert"
@end example

